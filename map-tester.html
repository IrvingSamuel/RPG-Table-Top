<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ğŸ—ºï¸ Map Tester - BigBridge RPG</title>
    <link rel="stylesheet" href="/css/map-tester.css">
    <!-- SweetAlert2 CSS -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/sweetalert2@11/dist/sweetalert2.min.css">
</head>
<body>
    <div class="container">
        <!-- Header -->
        <header class="header">
            <div class="header-content">
                <h1>ğŸ—ºï¸ Testador de Mapas</h1>
                <p class="subtitle">Upload de assets e teste em tempo real</p>
            </div>
            <button class="btn-back" onclick="window.close()">â† Voltar ao Admin</button>
        </header>

        <div class="main-layout">
            <!-- Sidebar de Upload -->
            <aside class="sidebar">
                <div class="sidebar-content">
                    <!-- InformaÃ§Ãµes do Mapa -->
                    <section class="section">
                        <h2>ğŸ“‹ InformaÃ§Ãµes do Mapa</h2>
                        <div class="form-group">
                            <label>ID da Mesa</label>
                            <input type="number" id="tableId" placeholder="Ex: 1, 2, 3..." required min="1">
                        </div>
                        <div class="form-group">
                            <label>Nome do Mapa</label>
                            <input type="text" id="mapName" placeholder="Ex: Hospital, Escola..." required>
                        </div>
                        <div class="form-row">
                            <div class="form-group">
                                <label>Largura (px)</label>
                                <input type="number" id="mapWidth" value="1920" min="512" max="8192" required>
                            </div>
                            <div class="form-group">
                                <label>Altura (px)</label>
                                <input type="number" id="mapHeight" value="1920" min="512" max="8192" required>
                            </div>
                        </div>
                        <div class="form-row">
                            <div class="form-group">
                                <label>Spawn X</label>
                                <input type="number" id="spawnX" value="960" min="0" required>
                            </div>
                            <div class="form-group">
                                <label>Spawn Y</label>
                                <input type="number" id="spawnY" value="960" min="0" required>
                            </div>
                        </div>
                    </section>

                    <!-- Upload de Texturas do Mapa -->
                    <section class="section">
                        <h2>ğŸŒ… Texturas do Mapa</h2>
                        
                        <!-- Dia -->
                        <div class="upload-area" id="upload-dia">
                            <input type="file" id="file-dia" accept="image/*" hidden>
                            <label for="file-dia" class="upload-label">
                                <div class="upload-icon">â˜€ï¸</div>
                                <div class="upload-text">
                                    <strong>Dia</strong>
                                    <span>Clique ou arraste a imagem</span>
                                </div>
                            </label>
                            <div class="upload-preview" id="preview-dia"></div>
                        </div>

                        <!-- Tarde -->
                        <div class="upload-area" id="upload-tarde">
                            <input type="file" id="file-tarde" accept="image/*" hidden>
                            <label for="file-tarde" class="upload-label">
                                <div class="upload-icon">ğŸŒ†</div>
                                <div class="upload-text">
                                    <strong>Tarde</strong>
                                    <span>Clique ou arraste a imagem</span>
                                </div>
                            </label>
                            <div class="upload-preview" id="preview-tarde"></div>
                        </div>

                        <!-- Noite -->
                        <div class="upload-area" id="upload-noite">
                            <input type="file" id="file-noite" accept="image/*" hidden>
                            <label for="file-noite" class="upload-label">
                                <div class="upload-icon">ğŸŒ™</div>
                                <div class="upload-text">
                                    <strong>Noite</strong>
                                    <span>Clique ou arraste a imagem</span>
                                </div>
                            </label>
                            <div class="upload-preview" id="preview-noite"></div>
                        </div>
                    </section>

                    <!-- Upload de ColisÃµes -->
                    <section class="section">
                        <h2>ğŸš§ ColisÃµes</h2>
                        
                        <!-- Limits -->
                        <div class="upload-area" id="upload-limits">
                            <input type="file" id="file-limits" accept="image/*" hidden>
                            <label for="file-limits" class="upload-label">
                                <div class="upload-icon">ğŸš§</div>
                                <div class="upload-text">
                                    <strong>ColisÃµes (Limits)</strong>
                                    <span>Ãreas bloqueadas</span>
                                </div>
                            </label>
                            <div class="upload-preview" id="preview-limits"></div>
                        </div>
                    </section>

                    <!-- Upload de Telhados -->
                    <section class="section">
                        <h2>ğŸ  Telhados por HorÃ¡rio</h2>
                        
                        <!-- Rooftops Dia -->
                        <div class="upload-area" id="upload-rooftops-dia">
                            <input type="file" id="file-rooftops-dia" accept="image/*" hidden>
                            <label for="file-rooftops-dia" class="upload-label">
                                <div class="upload-icon">â˜€ï¸</div>
                                <div class="upload-text">
                                    <strong>Telhados - Dia</strong>
                                    <span>Camada superior (dia)</span>
                                </div>
                            </label>
                            <div class="upload-preview" id="preview-rooftops-dia"></div>
                        </div>

                        <!-- Rooftops Tarde -->
                        <div class="upload-area" id="upload-rooftops-tarde">
                            <input type="file" id="file-rooftops-tarde" accept="image/*" hidden>
                            <label for="file-rooftops-tarde" class="upload-label">
                                <div class="upload-icon">ï¿½</div>
                                <div class="upload-text">
                                    <strong>Telhados - Tarde</strong>
                                    <span>Camada superior (tarde)</span>
                                </div>
                            </label>
                            <div class="upload-preview" id="preview-rooftops-tarde"></div>
                        </div>

                        <!-- Rooftops Noite -->
                        <div class="upload-area" id="upload-rooftops-noite">
                            <input type="file" id="file-rooftops-noite" accept="image/*" hidden>
                            <label for="file-rooftops-noite" class="upload-label">
                                <div class="upload-icon">ğŸŒ™</div>
                                <div class="upload-text">
                                    <strong>Telhados - Noite</strong>
                                    <span>Camada superior (noite)</span>
                                </div>
                            </label>
                            <div class="upload-preview" id="preview-rooftops-noite"></div>
                        </div>
                    </section>

                    <!-- Controles de Teste -->
                    <section class="section">
                        <h2>ğŸ® Controles de Teste</h2>
                        <div class="controls">
                            <button class="btn btn-primary" id="btn-load-test">
                                ğŸ”„ Carregar no Teste
                            </button>
                            <button class="btn btn-secondary" id="btn-toggle-limits">
                                ğŸ‘ï¸ Mostrar ColisÃµes
                            </button>
                            <button class="btn btn-secondary" id="btn-toggle-rooftops">
                                ğŸ  Mostrar Telhados
                            </button>
                            <button class="btn btn-secondary" onclick="window.location.reload()">
                                ğŸ”„ Reiniciar Tudo
                            </button>
                            <div class="time-selector">
                                <label>HorÃ¡rio do Teste:</label>
                                <select id="test-time">
                                    <option value="dia">â˜€ï¸ Dia</option>
                                    <option value="tarde">ğŸŒ† Tarde</option>
                                    <option value="noite">ğŸŒ™ Noite</option>
                                </select>
                            </div>
                        </div>
                    </section>

                    <!-- BotÃ£o de Salvar -->
                    <section class="section">
                        <button class="btn btn-success btn-lg" id="btn-save-map">
                            ğŸ’¾ Salvar Mapa no Banco
                        </button>
                        <p class="help-text">
                            Teste bem o mapa antes de salvar!<br>
                            Use WASD para mover o boneco de teste.
                        </p>
                    </section>
                </div>
            </aside>

            <!-- Canvas de Teste Phaser -->
            <main class="canvas-container">
                <div class="canvas-header">
                    <h3>ğŸ® Preview em Tempo Real</h3>
                    <div class="canvas-info">
                        <span id="canvas-fps">FPS: --</span>
                        <span id="canvas-pos">Pos: (0, 0)</span>
                    </div>
                </div>
                <div id="phaser-game"></div>
                <div class="canvas-instructions">
                    <p><strong>Controles:</strong></p>
                    <p>ğŸ® WASD - Mover personagem</p>
                    <p>ğŸ‘ï¸ BotÃµes laterais - Toggle de camadas</p>
                    <p>ğŸ”„ BotÃ£o "Carregar no Teste" - Aplicar uploads</p>
                </div>
            </main>
        </div>
    </div>

    <!-- Scripts - ORDEM IMPORTANTE -->
    <!-- SweetAlert2 JS -->
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    
    <!-- 1. Carregar Phaser 3 do CDN (versÃ£o local Ã© Phaser 2) -->
    <script src="https://cdn.jsdelivr.net/npm/phaser@3.55.2/dist/phaser.min.js"></script>
    
    <!-- 2. Verificar se Phaser 3 carregou -->
    <script>
        console.log('ğŸ” Verificando Phaser...');
        if (typeof Phaser === 'undefined') {
            console.error('âŒ Phaser nÃ£o carregou do CDN!');
            if (typeof Swal !== 'undefined') {
                Swal.fire({
                    icon: 'error',
                    title: 'Erro CrÃ­tico',
                    text: 'NÃ£o foi possÃ­vel carregar Phaser. Verifique sua conexÃ£o.',
                    confirmButtonColor: '#ef4444'
                });
            } else {
                alert('ERRO: NÃ£o foi possÃ­vel carregar Phaser. Verifique sua conexÃ£o.');
            }
        } else {
            console.log('âœ… Phaser v' + Phaser.VERSION + ' carregado com sucesso!');
            if (Phaser.VERSION.startsWith('2')) {
                console.error('âŒ ERRO: VersÃ£o incorreta! Phaser 2 detectado, mas precisa Phaser 3');
                if (typeof Swal !== 'undefined') {
                    Swal.fire({
                        icon: 'error',
                        title: 'VersÃ£o Incorreta',
                        text: 'Phaser 2 detectado. Recarregando com Phaser 3...',
                        confirmButtonColor: '#ef4444',
                        timer: 2000
                    }).then(() => location.reload());
                } else {
                    alert('ERRO: VersÃ£o incorreta do Phaser. Usando CDN...');
                    location.reload();
                }
            } else {
                console.log('âœ… Phaser 3 OK - Scene class disponÃ­vel');
            }
        }
    </script>
    
    <!-- 3. Carregar Scene depois que Phaser estiver disponÃ­vel -->
    <script src="/js/scenes/sceneMapTester.js"></script>
    
    <!-- 4. Carregar lÃ³gica principal por Ãºltimo -->
    <script src="/js/map-tester.js"></script>
</body>
</html>
